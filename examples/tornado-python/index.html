<!--
   
   Copyright (c) 2017, the Perspective Authors.
   
   This file is part of the Perspective library, distributed under the terms of
   the Apache License 2.0.  The full license can be found in the LICENSE file.

-->

<!DOCTYPE html>
<html>

<head>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

    <script src="http://localhost:8080/node_modules/perspective-viewer/dist/umd/perspective-viewer.js"></script>
    <script src="http://localhost:8080/node_modules/perspective-viewer-datagrid/dist/umd/perspective-viewer-datagrid.js"></script>
    <script src="http://localhost:8080/node_modules/perspective-viewer-d3fc/dist/umd/perspective-viewer-d3fc.js"></script>
    <script src="http://localhost:8080/node_modules/perspective/dist/umd/perspective.js"></script>

    <link rel='stylesheet' href="http://localhost:8080/node_modules/perspective-viewer/dist/umd/material-dense.css">

    <style>
        perspective-viewer{position:absolute;top:50px;left:0;right:0;bottom:0;}
        #state {padding:12px; font-family:"Open Sans";font-size:16px;}
    </style>

</head>

<body>
    <div id="state">none</div>
    <perspective-viewer 
        id="viewer">
    
    </perspective-viewer>

    <script>

        window.addEventListener('WebComponentsReady', async function() {

            /**
             * `perspective.websocket` connects to a remote Perspective server
             * that accepts WebSocket connections at the specified URL.
             * 
             * Use `perspective.websocket` to set up Perspective in server or
             * distributed modes.
             */
            window.state.innerText = "Connecting ...";
            const websocket = perspective.websocket("ws://localhost:8080/websocket");
            const websocket2 = perspective.websocket("ws://localhost:8080/websocket");
            const worker = perspective.worker();

            window.state.innerText = "Loading ...";
            const table = websocket.open_table('data_source_one')
            table.view().then(view => {
                view.to_arrow().then(async x => {
                    window.state.innerText = "Creating local table ...";
                    const table = worker.table(x);
                    await table.size();
                    window.state.innerText = "Loading locally ...";
                    await document.getElementById('viewer').swap(table);
                    window.state.innerText = "Local";
                });
            });


          //  const table = worker.table(view);
            
            // Load the local table in the `<perspective-viewer>`.

            await document.getElementById('viewer').load(websocket2.open_table('data_source_one'));
            window.state.innerText = "Server";
        });

    </script>

</body>

</html>